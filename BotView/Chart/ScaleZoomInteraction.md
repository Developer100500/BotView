# Управление масштабом через шкалы осей

## Обзор

Реализована возможность управления масштабом графика через интерактивные шкалы времени и цены. Пользователь может кликнуть в области шкалы и, удерживая ЛКМ, управлять масштабированием по соответствующей оси.

## Функциональность

### Шкала времени (горизонтальная ось)
**Область взаимодействия**: Внизу графика, в районе временных меток
**Управление**: Движение влево-вправо при удержании ЛКМ
**Эффект**: 
- Движение вправо → увеличение временного диапазона (zoom out)
- Движение влево → уменьшение временного диапазона (zoom in)

### Шкала цены (вертикальная ось)
**Область взаимодействия**: Справа от графика, в районе ценовых меток
**Управление**: Движение вверх-вниз при удержании ЛКМ
**Эффект**:
- Движение вниз → увеличение ценового диапазона (zoom out)
- Движение вверх → уменьшение ценового диапазона (zoom in)

## Техническая реализация

### Режимы масштабирования

```csharp
private enum ScaleZoomMode
{
    None,        // Обычный режим
    TimeScale,   // Масштабирование по времени
    PriceScale   // Масштабирование по цене
}
```

### Определение области шкал

```csharp
private ScaleZoomMode DetectScaleArea(Point point)
{
    const double tolerance = 15; // Погрешность в пикселях
    
    // Проверка области шкалы времени
    double timeScaleY = topMargin + chartHeight;
    if (point.Y >= timeScaleY - tolerance && point.Y <= timeScaleY + bottomMargin &&
        point.X >= leftMargin && point.X <= leftMargin + chartWidth)
    {
        return ScaleZoomMode.TimeScale;
    }
    
    // Проверка области шкалы цены
    double priceScaleX = leftMargin + chartWidth;
    if (point.X >= priceScaleX - tolerance && point.X <= priceScaleX + rightMargin &&
        point.Y >= topMargin && point.Y <= topMargin + chartHeight)
    {
        return ScaleZoomMode.PriceScale;
    }
    
    return ScaleZoomMode.None;
}
```

### Обработка масштабирования

```csharp
private void HandleScaleZoom(double deltaX, double deltaY)
{
    const double sensitivity = 0.01; // Чувствительность
    
    switch (scaleZoomMode)
    {
        case ScaleZoomMode.TimeScale:
            double timeZoomFactor = 1.0 + (deltaX * sensitivity);
            timeZoomFactor = Math.Clamp(timeZoomFactor, 0.5, 2.0);
            ZoomAxis(timeZoomFactor, 1.0);
            break;
            
        case ScaleZoomMode.PriceScale:
            double priceZoomFactor = 1.0 + (deltaY * sensitivity);
            priceZoomFactor = Math.Clamp(priceZoomFactor, 0.5, 2.0);
            ZoomAxis(1.0, priceZoomFactor);
            break;
    }
}
```

## Пользовательский интерфейс

### Визуальные индикаторы

**Курсоры**:
- `Cursors.SizeWE` - при наведении на шкалу времени (горизонтальное изменение размера)
- `Cursors.SizeNS` - при наведении на шкалу цены (вертикальное изменение размера)
- `Cursors.Arrow` - в обычном режиме

**Области взаимодействия**:
- Погрешность 15 пикселей для удобства использования
- Четкое разделение между областями шкал и основным графиком

### Поведение

1. **Наведение мыши**: Курсор автоматически меняется при наведении на область шкал
2. **Клик и удержание**: Активируется соответствующий режим масштабирования
3. **Перетаскивание**: Плавное изменение масштаба в реальном времени
4. **Отпускание**: Возврат к обычному режиму

## Параметры настройки

### Чувствительность
```csharp
const double sensitivity = 0.01; // Базовая чувствительность
```
- Меньшие значения = более плавное масштабирование
- Большие значения = более быстрое масштабирование

### Ограничения скорости
```csharp
timeZoomFactor = Math.Clamp(timeZoomFactor, 0.5, 2.0);
```
- Предотвращает слишком резкие изменения масштаба
- Обеспечивает плавность взаимодействия

### Область взаимодействия
```csharp
const double tolerance = 15; // Погрешность в пикселях
```
- Увеличивает удобство использования
- Компенсирует неточность позиционирования мыши

## Интеграция с существующей системой

### Совместимость с другими режимами
- Не конфликтует с обычным перетаскиванием графика
- Не влияет на масштабирование колесом мыши
- Сохраняет все существующие функции навигации

### Использование системы координат
- Использует существующие методы конвертации координат
- Интегрируется с системой камеры
- Автоматически обновляет viewport

### Фокус масштабирования
- Масштабирование происходит относительно центра экрана
- Сохраняет контекст при изменении масштаба
- Обеспечивает предсказуемое поведение

## Примеры использования

### Быстрое изменение временного диапазона
1. Наведите мышь на область шкалы времени внизу
2. Курсор изменится на горизонтальные стрелки
3. Нажмите и удерживайте ЛКМ
4. Двигайте мышь влево для увеличения детализации
5. Двигайте мышь вправо для уменьшения детализации

### Настройка ценового диапазона
1. Наведите мышь на область шкалы цены справа
2. Курсор изменится на вертикальные стрелки
3. Нажмите и удерживайте ЛКМ
4. Двигайте мышь вверх для увеличения детализации цен
5. Двигайте мышь вниз для уменьшения детализации цен

## Преимущества

### Удобство использования
- Интуитивно понятное управление
- Прямая связь между действием и результатом
- Визуальная обратная связь через курсоры

### Точность
- Независимое управление осями времени и цены
- Плавное изменение масштаба
- Ограничения предотвращают экстремальные значения

### Профессиональность
- Поведение аналогично TradingView и другим профессиональным платформам
- Стандартные курсоры и взаимодействия
- Интеграция с существующей функциональностью