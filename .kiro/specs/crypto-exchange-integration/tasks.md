# План реализации интеграции с криптовалютными биржами

- [x] 1. Обновить структуру данных OHLCV для поддержки timestamp





  - Добавить поле timestamp в структуру OHLCV в ChartView.cs
  - Создать новый конструктор с timestamp для совместимости с CCXT
  - Обновить метод GetDateTime() для использования timestamp
  - Сохранить обратную совместимость с существующим конструктором
  - _Требования: 1.1, 1.4_

- [x] 2. Создать интерфейсы и модели данных для работы с биржами





  - [x] 2.1 Создать интерфейс IDataProvider для конвертации данных CCXT


    - Определить методы ConvertFromCCXT, ConvertCCXTCandle, ValidateCCXTData
    - _Требования: 1.1, 1.4_

  - [x] 2.2 Создать интерфейс IExchangeService для работы с биржами


    - Определить методы GetCandlestickDataAsync, GetAvailableSymbolsAsync, TestConnectionAsync
    - Добавить методы для получения поддерживаемых бирж и таймфреймов
    - _Требования: 1.1, 2.1, 2.2, 3.1_

  - [x] 2.3 Создать модели данных ExchangeConfiguration, MarketSymbol, DataRequest


    - Определить структуры для конфигурации бирж и торговых пар
    - _Требования: 2.1, 2.2, 3.1_

- [x] 3. Реализовать DataProvider для конвертации данных CCXT





  - [x] 3.1 Реализовать класс DataProvider


    - Создать метод ConvertFromCCXT для преобразования массива данных CCXT в CandlestickData
    - Реализовать ConvertCCXTCandle для конвертации одной свечи
    - Добавить валидацию данных ValidateCCXTData
    - _Требования: 1.1, 1.4_

  - [x] 3.2 Добавить обработку ошибок в DataProvider


    - Создать исключения для некорректных данных
    - Добавить логирование ошибок конвертации
    - _Требования: 4.1, 4.2_

- [x] 4. Создать ExchangeFactory для управления экземплярами бирж





  - Реализовать фабричный метод CreateExchange для создания экземпляров CCXT бирж
  - Поддержать создание экземпляров для Binance, Bybit, OKX, Kraken
  - Добавить обработку неподдерживаемых бирж
  - _Требования: 2.1, 2.2_

- [ ] 5. Реализовать ExchangeService для работы с б
иржами
  - [x] 5.1 Создать основную логику ExchangeService

    - Реализовать GetCandlestickDataAsync с использованием CCXT FetchOHLCV
    - Добавить кэширование запросов для повышения производительности
    - Реализовать GetSupportedExchanges и GetSupportedTimeframes
    - _Требования: 1.1, 2.1, 5.2_

  - [x] 5.2 Добавить методы для работы с символами и тестирования соединения





    - Реализовать GetAvailableSymbolsAsync для получения доступных торговых пар
    - Создать TestConnectionAsync для проверки подключения к биржам
    - _Требования: 2.2, 3.4_

  - [x] 5.3 Реализовать обработку ошибок и повторные попытки





    - Создать ExchangeException с типизированными ошибками
    - Добавить логику повторных попыток для сетевых ошибок
    - Реализовать fallback на кэшированные данные при ошибках
    - _Требования: 4.1, 4.2, 4.3, 4.4_

- [ ] 6. Обновить ChartView для работы с timestamp из данных
  - [x] 6.1 Модифицировать метод GetCandleTime()





    - Изменить логику получения времени свечи для использования timestamp из OHLCV
    - Сохранить fallback на вычисление времени для старых данных без timestamp
    - _Требования: 1.1, 1.4_

  - [x] 6.2 Обновить методы отрисовки для работы с новым форматом данных





    - Убедиться что DrawCandlestick корректно работает с данными содержащими timestamp
    - Протестировать совместимость с существующими демо-данными
    - _Требования: 1.2, 1.5_

- [x] 7. Интегрировать сервисы в MainWindow





  - [x] 7.1 Добавить ExchangeService в MainWindow


    - Создать экземпляр ExchangeService и DataProvider
    - Заменить LoadDemoData на LoadRealData с использованием ExchangeService
    - _Требования: 1.2, 2.1_

  - [x] 7.2 Реализовать LoadRealData для получения данных с бирж


    - Создать метод LoadRealData с параметрами биржи, символа и таймфрейма
    - Добавить асинхронную загрузку данных без блокировки UI
    - Реализовать обработку ошибок с отображением сообщений пользователю
    - _Требования: 1.2, 4.2, 5.1, 5.3_

  - [x] 7.3 Добавить UI элементы для выбора биржи и символа


    - Создать ComboBox для выбора биржи из списка поддерживаемых
    - Добавить ComboBox для выбора торговой пары
    - Реализовать обработчики событий для обновления графика при смене параметров
    - _Требования: 2.3, 3.3_

- [x] 8. Обновить конфигурацию приложения





  - [x] 8.1 Расширить ExchangeConfig для поддержки новых настроек


    - Добавить настройки по умолчанию для биржи, символа и таймфрейма
    - Включить конфигурацию кэширования и таймаутов
    - _Требования: 2.1, 5.2_

  - [x] 8.2 Обновить App.xaml.cs для инициализации сервисов


    - Добавить создание экземпляров ExchangeService и DataProvider при запуске
    - Настроить конфигурацию по умолчанию
    - _Требования: 1.2, 2.1_

- [x] 9. Добавить логирование и мониторинг





  - [x] 9.1 Создать IExchangeLogger для логирования операций


    - Реализовать логирование API запросов, ошибок и полученных данных
    - _Требования: 4.5_



  - [x] 9.2 Добавить метрики производительности





    - Отслеживать время ответа API и использование кэша
    - _Требования: 5.2_

- [x] 10. Создать тесты для новой функциональности



  - [x] 10.1 Написать модульные тесты для DataProvider


    - Тестировать конвертацию данных CCXT в формат приложения
    - Проверить валидацию некорректных данных
    - _Требования: 1.4, 4.1_

  - [x] 10.2 Создать тесты для ExchangeService


    - Тестировать получение данных с мок-биржами
    - Проверить обработку ошибок и кэширование
    - _Требования: 1.1, 4.1, 5.2_

  - [x] 10.3 Добавить интеграционные тесты с реальными биржами


    - Создать тесты подключения к Binance testnet
    - Проверить полный поток данных от API до отображения
    - _Требования: 1.1, 2.1_